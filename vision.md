# Vision — Магазин тортов (Telegram-бот)

## 1. Технологии (MVP, KISS)
- Язык/рунтайм: Python 3.12+.
- Фреймворк бота: aiogram v3.
- Хранение данных: in-memory (dict/list), без внешних БД для MVP.
- Оплата: Telegram Payments (тестовый провайдер, один).
- Управление зависимостями: uv.
- Автоматизация: make (сборка, запуск, деплой).
- Тестирование: pytest.
- Деплой: Docker (один контейнер с ботом).

## 2. Принцип разработки
- KISS/MVP: только необходимый функционал для сценария заказа.
- Итеративно маленькими инкрементами; приоритет — рабочий happy-path.
- Тестируем ключевое: корзина, расчёт суммы, валидации выбора веса/количества.
- Линтеры/форматтеры: не подключаем на старте (приоритет скорости); можно добавить позже.
- Без pre-commit на MVP.
- Make цели: `make install` (uv), `make run`, `make test`, `make docker`.
- Версию Python (3.12) фиксируем в Docker/uv-конфиге.

## 3. Структура проекта (минимум)
- `bot/app.py` — точка входа бота.
- `bot/config.py` — конфиг (токен бота, платежи, базовые настройки).
- `bot/handlers/` — хендлеры команд/кнопок.
- `bot/keyboards/` — разметка кнопок.
- `bot/services/` — бизнес-логика (каталог, корзина, оформление заказа).
- `bot/storage.py` — in-memory данные и операции.
- `tests/` — базовые тесты корзины/валидаций.
- `Makefile`, `Dockerfile`, `vision.md`, `docs/idea.md`, `README.md`.

## 4. Архитектура (минимум, KISS)
- Поток: handlers → services → storage (in-memory).
- Handlers (aiogram): принимают команды/кнопки, валидируют ввод, вызывают сервисы, формируют ответы/клавиатуры.
- Services: бизнес-логика каталога, корзины, оформления заказа; расчёт суммы, проверка доступности веса/товара.
- Storage (in-memory): dict/list для каталога, корзин, заказов; простой слой-обёртка без БД.
- Конфиг: передача токенов/ключей через `config.py` (env/файл).
- Оплата: сервис выставляет инвойс через Telegram Payments; статус отслеживается в storage.
- Запуск: один процесс бота.

## 5. Модель данных (in-memory)
- CatalogItem: `id`, `title`, `description`, `category`, `price_per_unit` (за кг/шт), `weights` (список доступных весов/размеров), `photo_file_id`, `available: bool`.
- CartItem: `item_id`, `weight`, `quantity`.
- Cart: `user_id`, `items: list[CartItem]`.
- Order: `id`, `user_id`, `items` (снимок корзины), `total_amount`, `status` (`created|paid|processing`), `payment_payload`/`payment_id`.
- Веса — фиксированный список значений (например, 0.5/1/1.5 кг) для KISS.

## 6. Сценарий работы (happy-path, MVP)
1) Старт → меню категорий → выбор категории.
2) Просмотр карточек → выбор карточки → выбор веса и количества → добавить в корзину.
3) Просмотр/правка корзины → оформить заказ.
4) Ввод контактов/доставки (минимум: телефон; адрес/комментарий — коротко) → выставление инвойса Telegram Payments → оплата → подтверждение.
5) Корзина очищается/фиксируется по завершению заказа.

## 7. Деплой (минимум)
- Один Docker-контейнер на python:3.12-slim.
- Установка зависимостей через uv внутри контейнера.
- Запуск: `make run` или `python -m bot.app`.
- Конфиг через переменные окружения (токен бота, платежный провайдер).
- Оркестрации/compose нет на MVP.

## 8. Подход к конфигурированию
- Источник: переменные окружения (`BOT_TOKEN`, `PAYMENT_PROVIDER_TOKEN`, опционально `BASE_URL`).
- Парсинг в `config.py`, прокидываем в сервисы/handlers.
- Отдельных конфиг-файлов нет на MVP; `.env` можно локально по желанию.

## 9. Подход к логированию
- Стандартный `logging`, уровень INFO.
- Формат: `%(asctime)s %(levelname)s %(message)s`.
- Вывод в stdout (достаточно для Docker).
- Логируем ключевые события: старт бота, ошибки, оформление заказа, успешная/неуспешная оплата.
- Без внешних лог-хранилищ/трассировки на MVP.


